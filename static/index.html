<!DOCTYPE html>

<html lang="vi">
<head>
<meta charset="UTF-8">
<title>External Merge Sort</title>

<style>
body{
    font-family: Arial, Helvetica, sans-serif;
    background: #0f172a;
    color: white;
    text-align: center;
    padding-top: 80px;
}

.container{
    width: 500px;
    margin: auto;
    background: #1e293b;
    padding: 40px;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(0,0,0,0.4);
}

h1{
    margin-bottom: 30px;
}

input[type="file"]{
    margin: 20px 0;
}

button{
    padding: 12px 25px;
    border: none;
    border-radius: 8px;
    background: #22c55e;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

button:hover{
    background: #16a34a;
}

#status{
    margin-top: 25px;
    font-size: 18px;
}

#download{
    display:none;
    margin-top: 30px;
}

a{
    color: #38bdf8;
    font-size: 18px;
}
</style>

</head>

<body>

<div class="container">
    <h1>External Merge Sort</h1>

```
<input type="file" id="fileInput">
<br>
<button onclick="uploadFile()">Upload & Sort</button>

<div id="status"></div>

<div id="download">
    <p>File đã sắp xếp xong!</p>
    <a id="downloadLink" href="#">⬇ Tải file sorted.bin</a>
</div>
```

</div>

<script>

let jobId = null;

async function uploadFile(){
    const fileInput = document.getElementById("fileInput");
    const statusDiv = document.getElementById("status");
    const downloadDiv = document.getElementById("download");

    if(fileInput.files.length === 0){
        alert("Chọn file trước!");
        return;
    }

    downloadDiv.style.display = "none";
    statusDiv.innerHTML = "Đang upload...";

    let formData = new FormData();
    formData.append("file", fileInput.files[0]);

    // gửi file lên FastAPI
    const response = await fetch("/sort", {
        method: "POST",
        body: formData
    });

    const data = await response.json();
    jobId = data.job_id;

    statusDiv.innerHTML = "Upload xong. Đang sắp xếp...";

    checkStatus();
}

async function checkStatus(){
    const statusDiv = document.getElementById("status");
    const downloadDiv = document.getElementById("download");
    const downloadLink = document.getElementById("downloadLink");

    const res = await fetch(`/status/${jobId}`);
    const data = await res.json();

    if(data.status === "processing" || data.status === "queued"){
        statusDiv.innerHTML = "Server đang sắp xếp file... (có thể mất vài phút)";
        setTimeout(checkStatus, 3000);
    }
    else if(data.status === "done"){
        statusDiv.innerHTML = "Hoàn thành!";
        downloadDiv.style.display = "block";
        downloadLink.href = `/download/${jobId}`;
    }
    else{
        statusDiv.innerHTML = "Lỗi: " + data.status;
    }
}

</script>

</body>
</html>
